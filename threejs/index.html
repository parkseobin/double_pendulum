<html>	
	<head>
		<title>Three.js Crash Course</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100%; };
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/runge_kutta.js"></script>
		<script>
			var scene = new THREE.Scene();
			// Virtual camera, what the user sees thru
			// See the documentation
			var camera = new THREE.PerspectiveCamera(75, 
					window.innerWidth / window.innerHeight, 0.1, 1000);
			
			var renderer = new THREE.WebGLRenderer();
			renderer.setPixelRatio(10);
			document.body.appendChild(renderer.domElement);

	
			// create the shape
			var geometry = new THREE.BoxGeometry(.1, 2, .1);
			var geometry2 = new THREE.BoxGeometry(.1, 2, .1);

			// create a material, colour or image texture
			var material = new THREE.MeshBasicMaterial({ color: 0xffffff,
													wireframe: false });
			var material2 = new THREE.MeshBasicMaterial({ color: 0xffffff,
													wireframe: false });
			var cube1 = new THREE.Mesh(geometry, material);
			var cube2 = new THREE.Mesh(geometry2, material2);
			scene.add(cube1);
			scene.add(cube2);
		
			// camera is inside the cube (at the origin)
			// so we need to move
			camera.position.z = 6;


			th1 = Math.PI*Math.random();
			th2 = Math.PI*Math.random();
			w1 = 0;
			w2 = 0;
			y_pass = [th1, w1, th2, w2];

			// game logic
			var update = function()
			{
				//cube1.position.set(0, 0, 0);
				//cube2.position.set(0, 0, 0);
				cube1.matrix.set(
						1, 0, 0, 0,
						0, 1, 0, 0,
						0, 0, 1, 0,
						0, 0, 0, 1
				);
				cube2.matrix.set(
						1, 0, 0, 0,
						0, 1, 0, 0,
						0, 0, 1, 0,
						0, 0, 0, 1
				);
				
				//doublePendulumTransform(th1, th2, 2., 2.);
				doublePendulumTransform(y_pass[0], y_pass[2], 2., 2.);
				y_pass = runge_kutta(y_pass, 0.01);
				console.log(y_pass);
			};

			var doublePendulumTransform = function(th1, th2, l1, l2)
			{
				trans_l1 = make_mat('translation', l1);
				trans_l2 = make_mat('translation', l2);
				rot_th1 = make_mat('rotation', th1);
				rot_th2 = make_mat('rotation', th2-th1);

				cube2.applyMatrix(trans_l2);
				cube2.applyMatrix(rot_th2);
				cube2.applyMatrix(trans_l1);
				cube2.applyMatrix(trans_l1);
				cube2.applyMatrix(rot_th1);

				cube1.applyMatrix(trans_l1);
				cube1.applyMatrix(rot_th1);
			};

			var make_mat = function(flag, param)
			{
				var mat = new THREE.Matrix4();
				if(flag == 'translation')
				{
					// -l/2 translation towards y-axis
					mat.set(
							1, 0, 0, 0,
							0, 1, 0, -param/2,
							0, 0, 1, 0,
							0, 0, 0, 1
					);
				}
				else if(flag == 'rotation')
				{	
					// theta rotation with z-axis
					mat.set(
							Math.cos(param), -Math.sin(param), 0, 0,
							Math.sin(param), Math.cos(param), 0, 0, 
							0, 0, 1, 0,
							0, 0, 0, 1
					);
				}
				else
				{
					// pass
					return;
				}
				return mat;
			}

			// draw scene
			var render = function()
			{
				renderer.render(scene, camera);
			};

			// reun game loop (update, render, repeat)
			var GameLoop = function()
			{
				requestAnimationFrame(GameLoop);

				update();
				render();
			}

			GameLoop();
		</script>
	</body>
</html>
